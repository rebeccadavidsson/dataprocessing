
<!DOCTYPE html>
<html>
<head>
  <title>JavaScript opdracht</title>
</head>
  <link rel="stylesheet" href="style.css">

    <body style="background-color:#DCDCDC;">
       <div class="title"> Percentage of longest possible sunshine in De Bilt (01/11/2018  -  15/11/2018)</div>

      <canvas id="myCanvas" width="630" height="350" style="background-color:silver;"></canvas>
      <script>

        var fileName = "sun.json";
        var txtFile = new XMLHttpRequest();
        txtFile.onreadystatechange = function() {
            if (txtFile.readyState === 4 && txtFile.status == 200) {
                var json = JSON.parse(txtFile.responseText);

                // Size of dataset is used for the x-axis
                var size = Object.keys(json).length;
                var max = 100
                var height = 300
                var width = 600
                var counter = 0

                function createTransform(domain, range){
              	// domain is a two-element array of the data bounds [domain_min, domain_max]
              	// range is a two-element array of the screen bounds [range_min, range_max]
              	// this gives you two equations to solve:
              	// range_min = alpha * domain_min + beta
              	// range_max = alpha * domain_max + beta

                  var domain_min = domain[0]
                  var domain_max = domain[1]
                  var range_min = range[0]
                  var range_max = range[1]

                  // formulas to calculate the alpha and the beta
                 	var alpha = (range_max - range_min) / (domain_max - domain_min)
                  var beta = range_max - alpha * domain_max

                  // returns the function for the linear transformation (y= a * x + b)
                  return function(x){
                    return alpha * x + beta;
                  }
                }
                // transform x- and y-axis
                var x_axis = createTransform([0, size - 1], [40, width]);
                var y_axis = createTransform([0, max], [height, 20]);

                // Make a new canvas
                var ctx = document.getElementById('myCanvas').getContext('2d');

                // Add vertical ticks
                ctx.beginPath();
                var i;
                for (i = 0; i <= 15; i++) {
                  ctx.moveTo(x_axis(i), y_axis(0));
                  ctx.strokeStyle = '#DCDCDC'
                  ctx.lineTo(x_axis(i), y_axis(2.5));
                  ctx.stroke();
                  ctx.closePath();
                }

                // Add horizontal grid
                ctx.beginPath();
                var i;
                for (i = max; i >= 0; i = i - 10) {
                  ctx.moveTo(x_axis(0), y_axis(i));
                  ctx.lineTo(x_axis(size - 1), y_axis(i));
                  ctx.stroke();
                  ctx.closePath();
                }

                // Set begining of path outside the for-loop where the line is made
                ctx.beginPath();

                // Iterate over the json file to get every key and value
                Object.keys(json).forEach(function(key) {
                var date = key
                var value = json[key]
                console.log(date, value)

                // Define x-coördate and y-coördinate of specific key and value
                var x = x_axis(counter)
                var y = y_axis(json[key])

                // Move current line to the transformed coördinates
                ctx.lineTo(x, y);
                ctx.fillText(value, x, y)
                ctx.strokeStyle = 'blue'
                ctx.stroke();

                counter = counter + 1

              })

              // Add numbers to the x-axis
              for (i = 1; i <= size; i++) {
              ctx.moveTo(x_axis(i), y_axis(0));
              var date = [i] + '/11'
              ctx.fillText(date, x_axis(i - 1.2), y_axis(-5));
              }

              // Add numbers to the y-axis
              for (i = max; i >= 0; i = i - 10) {
              ctx.moveTo(x_axis(0), y_axis(i));
              ctx.fillText(i, x_axis(-0.4), y_axis(i));
              }

              // Position x- and y-axis titles
              ctx.fillText("days from 01/11/18 until 15/11/18", x_axis(size - 5), y_axis(-12));
              ctx.rotate(-Math.PI/2);
              ctx.textAlign = "center";
              ctx.fillText("Percentage", x_axis(-2), y_axis(max + 1));
            }

        }
        txtFile.open("GET", fileName);
        txtFile.send();
      </script>

      <p id="click">
      <script>
      document.addEventListener("click", myFunction);
        function myFunction() {
            alert ("This is a line chart of the percentage of longest possible sunshine in De Bilt (01/11/2018 - 15/11/2018). Data is provided by KNMI.nl ");
        }
      </script>

    </body>

</html>
